@if (this.chatService.selectedChannel) {
    <section class="chat-section">
        <header class="header">
            <div *ngIf="!isNewMessage" class="chat-header">
                <div (click)="toggleModal()" class="chat-title">
                    <img class="icon" src="assets/img/chat/channel_tag.svg"/>
                    <h1>
                        {{
                            this.chatService.selectedChannel.channelName ||
                            "Development"
                        }}
                    </h1>
                    <img class="arrow" src="assets/img/chat/arrow_down.svg"/>
                </div>

                <div class="chat-members">
                    <div class="members">
                        <div
                            *ngFor="
                            let member of this.chatService.selectedChannel
                                .channelMembers
                        "
                            class="member"
                        >
                            <img [src]="member.photoURL"/>
                        </div>
                        <div class="member-counter">
                            {{
                                this.chatService.selectedChannel.channelMembers
                                    .length || 0
                            }}
                        </div>
                    </div>
                    <div (click)="addMemberModal()" class="add-member">
                        <img src="assets/img/chat/add_member.svg"/>
                    </div>

                    <div *ngIf="isAddMemberModalOpen" class="add-member-modal">
                        <header class="add-member-modal-header">
                            <div>
                                <h1>Add Member</h1>
                                <div class="add-member-channel-name">
                                    <img
                                        src="assets/img/chat/channel_tag_hover.svg"
                                    />
                                    {{
                                        this.chatService.selectedChannel
                                            .channelName || "Development"
                                    }}
                                </div>
                            </div>
                            <div (click)="closeModals()" class="close-btn">
                                <img src="assets/img/chat/close.svg"/>
                            </div>
                        </header>
                        <div class="member-input-container">
                            <div class="selected-user-chip" *ngFor="let user of selectedUsersToAdd">
                                <img [src]="user.photoURL" alt="avatar"/>
                                <span>{{ user.userName }}</span>
                                <button (click)="removeUser(user)">Ã—</button>
                            </div>
                            <input
                                type="text"
                                placeholder="Add Name"
                                class="add-member-input"
                                [(ngModel)]="searchText"
                                (ngModelChange)="onSearchInputChange()"
                            />
                        </div>
                        <div class="user-suggestion-list" *ngIf="filteredUsers.length > 0">
                            <div
                                *ngFor="let user of filteredUsers"
                                (click)="addUserToSelection(user)"
                                class="suggestion"
                            >
                                <img [src]="user.photoURL"/>
                                <span>{{ user.userName }}</span>
                            </div>
                        </div>
                        <div>
                            <button (click)="addNewMember()" class="button">
                                Add Member
                            </button>
                        </div>
                    </div>
                </div>

                <div *ngIf="isAddNewChannel" class="modal">
                    <!-- <div *ngIf="isModalOpen" class="modal"> -->
                    <div class="container">
                        <header class="modal-header">
                            <div>
                                <img
                                    class="tag"
                                    src="assets/img/chat/channel_tag.svg"
                                />
                                <h1>
                                    {{
                                        this.chatService.selectedChannel
                                            .channelName || "Development"
                                    }}
                                </h1>
                            </div>
                            <div (click)="closeModals()" class="close-btn">
                                <img src="assets/img/chat/close.svg"/>
                            </div>
                        </header>
                        <main class="modal-main">
                            <div *ngIf="!isNameEdit" class="name-container">
                                <div>
                                    <h2>Channel-Name</h2>
                                    <button (click)="toggleNameEdit()">
                                        Bearbeiten
                                    </button>
                                </div>
                                <div class="name">
                                    <img src="assets/img/chat/channel_tag.svg"/>
                                    {{
                                        this.chatService.selectedChannel.channelName
                                    }}
                                </div>
                            </div>

                            <div *ngIf="isNameEdit" class="name-container-edit">
                                <div>
                                    <h2>Channel-Name</h2>
                                    <button (click)="toggleNameEdit()">
                                        Speichern
                                    </button>
                                </div>
                                <div class="input-container">
                                    <img src="assets/img/chat/channel_tag.svg"/>
                                    <input
                                        [(ngModel)]="newChannelName"
                                        placeholder="Channel Name"
                                        type="text"
                                    />
                                </div>
                            </div>

                            <div
                                *ngIf="!isDescriptionEdit"
                                class="description-container"
                            >
                                <div>
                                    <h2>Description</h2>
                                    <button (click)="toggleDescriptionEdit()">
                                        Bearbeiten
                                    </button>
                                </div>
                                <div class="description">
                                    {{
                                        this.chatService.selectedChannel
                                            .channelDescription ||
                                        "Keine Beschreibung"
                                    }}
                                </div>

                                <div class="seperator"></div>

                                <h2>Created by</h2>
                                <div class="creator">
                                    {{
                                        this.chatService.selectedChannel.createdBy
                                            .userName || "Unbekannt"
                                    }}
                                </div>
                            </div>

                            <div
                                *ngIf="isDescriptionEdit"
                                class="description-container-edit"
                            >
                                <div>
                                    <h2>Description</h2>
                                    <button (click)="toggleDescriptionEdit()">
                                        Speichern
                                    </button>
                                </div>
                                <div class="input-container">
                                    <input
                                        [(ngModel)]="newChannelDescription"
                                        placeholder="Description"
                                        type="text"
                                    />
                                </div>

                                <div class="seperator"></div>

                                <h2>Created by</h2>
                                <div class="creator">
                                    {{
                                        this.chatService.selectedChannel
                                            .createdBy || "Unbekannt"
                                    }}
                                </div>
                            </div>
                        </main>
                    </div>
                </div>
            </div>

            <div
                (keydown)="onKeyDown($event)"
                *ngIf="isNewMessage"
                class="new-message-header"
            >
                <h1>New Message</h1>
                <div>
                    <input
                        name="description"
                        placeholder="To: #channel, or @anybody or E-Mail Adress"
                        type="text"
                    />
                </div>
            </div>
        </header>

        <main class="chat-main">
            <div class="chat-history">
                <ng-container
                    *ngFor="
                    let message of messages;
                    let i = index;
                    trackBy: trackByMessageId
                "
                >
                    <ng-container *ngIf="shouldShowDate(messages, i)">
                        <div class="message-time-seperator">
                            <div class="time">{{ message.date }}</div>
                        </div>
                    </ng-container>

                    <app-chat-message-other
                        [message]="message"
                    ></app-chat-message-other>
                </ng-container>
            </div>
        </main>
        <app-message-input-field
            (send)="sendChatMessage($event)"
            class="message-input-field"
        ></app-message-input-field>
    </section>

    <div (click)="closeModals()" *ngIf="isModalBGOpen" class="modal-bg"></div>

}
